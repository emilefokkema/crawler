Template
	= parts:(TemplatePart)+

TemplatePart
	= IfExpression / SimpleExpression / TemplateTextPart

TemplateTextPart
	= t:TemplateText {return {type: "text", text: t}}

IfExpression
	= predicate:If template:EnclosedTemplate {return {type: "if", predicate: predicate, template: template}}
    
EnclosedTemplate
	= OpenBlock template:Template CloseBlock {return template;}

SimpleExpression
	= OpenBlock expression:TemplateText CloseBlock {return {type: "simple", expression: expression}}

TemplateText
	= (!Control .)+ {return text();}

Control
	= If / OpenBlock / CloseBlock

CloseBlock
	= "}}"

OpenBlock
	= "{{"

If = 
	"if" parens:Parens {return parens;}

Parens
	= "(" inside:InsideParens ")" {return inside;}

InsideParens = 
	(Parens / WithoutParens)+ {return text();}

WithoutParens
	=	(!("(" / ")").)+